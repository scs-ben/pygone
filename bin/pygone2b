#!/usr/bin/env pypy3
import math,random,sys,time
Za=None
Zb=enumerate
Zc=random.getrandbits
Zd=time.time
Ze=range
Zf=math.ceil
Zg=sorted
class g1:
	size=2**31//32;o8=[Za]*size
	def o6(B,key,AH,b1,c8,b2):
		D=AH;C=key;E=C%B.size;A=B.o8[E]
		if not A or A[0]!=C or A[2]<D or A[2]==D and c8=='dn':B.o8[E]=[C,b1,D,c8,b2]
	def o5(B,key):
		A=B.o8[key%B.size]
		if A is not Za and A[0]==key:return A
class g3:
	dv=32e4
	def __init__(A,AG):A.AG=AG;A.fk=0;A.tt=g1();A.co=Za;A.cp=Za;A.cb=0;A.AH=50
	def fg(A,o7):B=o7;A.co=B;A.cp=Zd()+B;A.cb=0
	def G1(A,AG):A.AG=AG
	def cl(A):
		H=Zd();B=Za;C=Za;A.fk=0
		for D in Ze(1,A.AH+1):
			if A.cb:break
			I=A.cu(D,-A.dv,A.dv)
			if A.cb:break
			C=I;E=A.tt.o5(A.AG.c3)
			if E and E[4]:B=E[4]
			F=Zd()-H;J=Zf(A.fk/F)if F>0 else 1;G=A.AG.ai(B)if B else Za
			if G:print(f"info depth {D} score cp {Zf(C)} time {Zf(F*1e3)} nodes {A.fk} nps {J} pv {G}",flush=1)
			if D>=A.AH:break
		return B,C
	def fm(A):
		B=1
		for C in A.AG.hx:
			B+=C[-1]==A.AG.c3
			if B>=3:return 1
		return 0
	def cu(A,AH,cw=-dv,cx=dv,fx=0):
		G=fx;F=cx;E=cw;D=AH
		if A.cb or A.co and Zd()>=A.cp:A.cb=1;return 0
		if A.fm()or A.AG.h3>=100:return 0
		if D<=0:return A.c7(E,F)
		P=F>E+1;Q=E;A.fk+=1;B=A.tt.o5(A.AG.c3)
		if B and B[2]>=D and not P:
			if B[3]=='dn'or B[3]=='do'and B[1]>=F or B[3]=='dp'and B[1]<=E:return B[1]
		M=A.AG.ca();H=A.AG.fl()
		if not P and not M:
			if D<=2 and H+100*D<=E:return H
			if D<=3 and H>=F-80*D:return H
		C=-1e9;I=Za;N=0;O=Zg(A.AG.aw1(),key=A.AG.cn,reverse=1)
		if B and B[4]:O=[B[4]]+O
		D+=M
		for J in O:
			if N>0 and B and B[4]==J:continue
			A.AG.hn(J);N+=1;K=-A.cu(D-1,-F,-E,G+1);A.AG.hn1()
			if A.cb:break
			if not I:I=J
			if K>C:
				C=K;I=J
				if K>E:
					E=K
					if E>=F:break
		if not N:return-A.dv+G if M else 0
		if C<=Q:L='dp'
		elif C>=F:L='do'
		else:L='dn'
		if not A.cb:
			R=I if L!='dp'else Za
			if C>A.dv-1e3:C+=G
			elif C<-A.dv+1e3:C-=G
			A.tt.o6(A.AG.c3,D,C,L,R)
		return C
	def c7(A,cw,cx,cm=0):
		G=cm;D=cx;B=cw
		if A.cb or A.co and Zd()>=A.cp:A.cb=1;return 0
		if A.fm()or A.AG.h3>=100:return 0
		A.fk+=1;C=A.tt.o5(A.AG.c3)
		if C and C[2]==0:
			if C[3]=='dn'or C[3]=='do'and C[1]>=D or C[3]=='dp'and C[1]<=B:return C[1]
		E=A.AG.fl()
		if G>=30 or E>=D:return E
		B=max(B,E);F=A.AG.ca()
		if not F and E>=D:return D
		if not F and B<E:B=E
		for I in Zg(A.AG.aw1(not F),key=A.AG.cn,reverse=1):
			A.AG.hn(I);H=-A.c7(-D,-B,G+1);A.AG.hn1()
			if A.cb:break
			if H>B:
				B=H
				if B>=D:return B
		return B
da='abcdefgh'
db='12345678'
d9=['p','n','b','r','q','k','p','n','b','r','q','k']
dw=[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,20,20,15,5,-30,-30,5,15,20,20,15,5,-30,-30,0,10,15,15,10,0,-30,-40,-20,0,0,0,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50]
dx=[1,3,2,1,1,4]
def hq(s):return 1<<s
def hr(bb):A=bb&-bb;B=A.bit_length()-1;return bb^A,B
N,S,E,W,NE,NW,SE,SW=8,-8,1,-1,9,7,-7,-9
dd=N,S,E,W
de=NE,NW,SE,SW
dh=[0]*64
dc=[0]*64
dt=[0]*64
dg=[0]*64
for sq in Ze(64):
	r=sq//8;f=sq%8;bm=0
	for d in(17,15,10,6,-6,-10,-15,-17):
		ns=sq+d
		if 0<=ns<64:
			rr=ns//8;ff=ns%8
			if abs(rr-r)+abs(ff-f)==3:bm|=hq(ns)
	dh[sq]=bm;bm=0
	for d in(1,-1,8,-8,9,7,-7,-9):
		ns=sq+d
		if 0<=ns<64:
			rr=ns//8;ff=ns%8
			if max(abs(rr-r),abs(ff-f))==1:bm|=hq(ns)
	dc[sq]=bm;bm_w=0
	if f>0 and r<7:bm_w|=hq(sq+7)
	if f<7 and r<7:bm_w|=hq(sq+9)
	dt[sq]=bm_w;bm_b=0
	if f>0 and r>0:bm_b|=hq(sq-9)
	if f<7 and r>0:bm_b|=hq(sq-7)
	dg[sq]=bm_b
random.seed(2025)
d8=[[Zc(64)for A in Ze(64)]for A in Ze(12)]
dj=[Zc(64)for A in Ze(16)]
dk=[Zc(64)for A in Ze(8)]
du=Zc(64)
class g4:
	df={'p':100,'n':320,'b':330,'r':500,'q':900,'k':0}
	def __init__(A,fu=Za):A.P=[0]*12;A.fs=[-1]*64;A.a1=1;A.hw=0;A.ep=-1;A.h3=0;A.hx=[];A.P=[65280,66,36,129,8,16,0xff000000000000,0x4200000000000000,0x2400000000000000,0x8100000000000000,0x800000000000000,0x1000000000000000];A.c3=0x5df63efdaea349a5
	def fzs_of(A,qy1):
		if qy1:return A.P[0]|A.P[1]|A.P[2]|A.P[3]|A.P[4]|A.P[5]
		else:return A.P[6]|A.P[7]|A.P[8]|A.P[9]|A.P[10]|A.P[11]
	def hu(B):
		A=0
		for C in B.P:A|=C
		return A
	def hs(B,qy,fp):A=fp;return A if qy else A+6
	def AB1(A,s):return da.index(s[0])+8*int(s[1])-8
	def hn(A,mv):
		D,C,L,S,S=mv;A.hx.append((A.P[:],A.fs[:],A.a1,A.hw,A.ep,A.h3,A.c3));B=A.a1;A.c3^=du
		if A.ep!=-1:A.c3^=dk[A.ep&7]
		A.c3^=dj[A.hw];O=hq(D);I=hq(C);E=Za
		for J in Ze(6):
			H=A.hs(B,J)
			if A.P[H]&O:A.c3^=d8[H][D];E=J;A.P[H]^=O;A.fs[D]=-1;break
		K=0
		if E==0 and C==A.ep:K=1;M=C-8 if B else C+8;A.c3^=d8[A.hs(not B,0)][M];A.P[A.hs(not B,0)]^=hq(M);A.fs[M]=-1
		else:
			for J in Ze(6):
				H=A.hs(not B,J)
				if A.P[H]&I:A.c3^=d8[H][C];A.P[H]^=I;A.fs[C]=-1;K=1;break
		A.h3+=1
		if K or E==0:A.h3=0
		if L:P={'q':4,'r':3,'b':2,'n':1};Q=A.hs(B,P[L]);A.P[A.hs(B,P[L])]|=I;A.c3^=d8[Q][C];A.fs[C]=Q
		else:R=A.hs(B,E);A.P[A.hs(B,E)]|=I;A.c3^=d8[R][C];A.fs[C]=R
		if E==5:
			if B:A.hw&=~3
			else:A.hw&=~12
		if E==3:
			if B and D==0:A.hw&=~2
			if B and D==7:A.hw&=~1
			if not B and D==56:A.hw&=~8
			if not B and D==63:A.hw&=~4
		if K:
			if C==0:A.hw&=~2
			if C==7:A.hw&=~1
			if C==56:A.hw&=~8
			if C==63:A.hw&=~4
		N=4;F=6;G=2
		if not B:N=60;F=62;G=58
		if E==5 and D==N and C==F:A.c3^=d8[A.hs(B,3)][F+1];A.c3^=d8[A.hs(B,3)][F-1];A.P[A.hs(B,3)]^=hq(F+1);A.P[A.hs(B,3)]|=hq(F-1);A.fs[F+1]=-1;A.fs[F-1]=A.hs(B,3)
		if E==5 and D==N and C==G:A.c3^=d8[A.hs(B,3)][G-2];A.c3^=d8[A.hs(B,3)][G+1];A.P[A.hs(B,3)]^=hq(G-2);A.P[A.hs(B,3)]|=hq(G+1);A.fs[G-2]=-1;A.fs[G+1]=A.hs(B,3)
		A.c3^=dj[A.hw]
		if E==0 and abs(C-D)==16:A.ep=(D+C)//2
		else:A.ep=-1
		if A.ep!=-1:A.c3^=dk[A.ep&7]
		A.a1=not A.a1
	def hn1(A):
		if not A.hx:return
		B,C,D,E,F,G,c3=A.hx.pop();A.P=B;A.fs=C;A.a1=D;A.hw=E;A.ep=F;A.h3=G;A.c3=c3
	def hp(A,sq,a4):
		G=sq;C=a4;I=A.hu();J=A.P[A.hs(C,3)]|A.P[A.hs(C,4)];K=A.P[A.hs(C,2)]|A.P[A.hs(C,4)]
		if C:
			if dg[G]&A.P[A.hs(1,0)]:return 1
		elif dt[G]&A.P[A.hs(0,0)]:return 1
		if dh[G]&A.P[A.hs(C,1)]:return 1
		if dc[G]&A.P[A.hs(C,5)]:return 1
		for D in dd:
			F=G
			while 1:
				B=F+D
				if B<0 or B>=64:break
				if D==E and B%8==0:break
				if D==W and B%8==7:break
				F=B;H=hq(F)
				if H&J:return 1
				if H&I:break
		for D in de:
			F=G
			while 1:
				B=F+D
				if B<0 or B>=64:break
				if D in(NE,SE)and B%8==0:break
				if D in(NW,SW)and B%8==7:break
				F=B;H=hq(F)
				if H&K:return 1
				if H&I:break
		return 0
	def o3(B,qy):A=B.P[B.hs(qy,5)];return(A&-A).bit_length()-1 if A else-1
	def ca(A,qy=1):return A.hp(A.o3(A.a1),not A.a1)if qy else A.hp(A.o3(not A.a1),A.a1)
	def aw1(A,c4=0):
		C=[]
		for B in A.ht():
			A.hn(B)
			if not A.ca(0)and(not c4 or B[3]or B[2]):C.append(B)
			A.hn1()
		return C
	def ht(B):
		H=B.a1;I=B.hu();M=B.fzs_of(H);N=B.fzs_of(not H);O=B.P[B.hs(H,0)]
		while O:
			O,A=hr(O)
			if H:
				if not I&hq(A+8)and A//8<7:
					if A//8==6:
						for K in('q','r','b','n'):yield(A,A+8,K,Za,'p')
					else:
						yield(A,A+8,Za,Za,'p')
						if A//8==1 and not I&hq(A+16):yield(A,A+16,Za,Za,'p')
				for C in(A+7,A+9):
					if 0<=C<64:
						if dt[A]&hq(C)and N&hq(C):
							if A//8==6:
								for K in('q','r','b','n'):yield(A,C,K,B.fr(C),'p')
							else:yield(A,C,Za,B.fr(C),'p')
				if B.ep!=-1:
					if dt[A]&hq(B.ep):yield(A,B.ep,Za,'p','p')
			else:
				if not I&hq(A-8)and A//8>0:
					if A//8==1:
						for K in('q','r','b','n'):yield(A,A-8,K,Za,'p')
					else:
						yield(A,A-8,Za,Za,'p')
						if A//8==6 and not I&hq(A-16):yield(A,A-16,Za,Za,'p')
				for C in(A-7,A-9):
					if 0<=C<64:
						if dg[A]&hq(C)and N&hq(C):
							if A//8==1:
								for K in('q','r','b','n'):yield(A,C,K,B.fr(C),'p')
							else:yield(A,C,Za,B.fr(C),'p')
				if B.ep!=-1:
					if dg[A]&hq(B.ep):yield(A,B.ep,Za,'p','p')
		P=B.P[B.hs(H,1)]
		while P:
			P,A=hr(P);U=dh[A]&~M;L=U
			while L:L,C=hr(L);yield(A,C,Za,B.fr(C),'n')
		Q=B.P[B.hs(H,2)]
		while Q:
			Q,A=hr(Q)
			for G in de:
				D=A
				while 1:
					F=D+G
					if F<0 or F>=64:break
					if G in(NE,SE)and F%8==0:break
					if G in(NW,SW)and F%8==7:break
					D=F;J=hq(D)
					if J&M:break
					yield(A,D,Za,B.fr(D),'b')
					if J&N:break
		R=B.P[B.hs(H,3)]
		while R:
			R,A=hr(R)
			for G in dd:
				D=A
				while 1:
					F=D+G
					if F<0 or F>=64:break
					if G==E and F%8==0:break
					if G==W and F%8==7:break
					D=F;J=hq(D)
					if J&M:break
					yield(A,D,Za,B.fr(D),'r')
					if J&N:break
		S=B.P[B.hs(H,4)]
		while S:
			S,A=hr(S)
			for G in dd+de:
				D=A
				while 1:
					F=D+G
					if F<0 or F>=64:break
					if G in(E,NE,SE)and F%8==0:break
					if G in(W,NW,SW)and F%8==7:break
					D=F;J=hq(D)
					if J&M:break
					yield(A,D,Za,B.fr(D),'q')
					if J&N:break
		T=B.o3(H)
		if 0<=T<64:
			for V in(dc[T]&~M,):
				L=V
				while L:L,C=hr(L);yield(T,C,Za,B.fr(C),'k')
			if H:
				if B.hw&1 and not I&(hq(5)|hq(6)):
					if not B.hp(4,0)and not B.hp(5,0)and not B.hp(6,0):yield(4,6,Za,Za,'k')
				if B.hw&2 and not I&(hq(1)|hq(2)|hq(3)):
					if not B.hp(4,0)and not B.hp(3,0)and not B.hp(2,0):yield(4,2,Za,Za,'k')
			else:
				if B.hw&4 and not I&(hq(61)|hq(62)):
					if not B.hp(60,1)and not B.hp(61,1)and not B.hp(62,1):yield(60,62,Za,Za,'k')
				if B.hw&8 and not I&(hq(57)|hq(58)|hq(59)):
					if not B.hp(60,1)and not B.hp(59,1)and not B.hp(58,1):yield(60,58,Za,Za,'k')
	def p6_safety(C,qy):
		A=qy;D=C.o3(A);G=D%8;H=D//8;I=1 if A else-1;J=0 if A else 6;K=1 if A else 4;L=2 if A else 8;B=0
		for M in(-1,0,1):
			E=G+M;F=H+I
			if 0<=E<8 and 0<=F<8:
				N=F*8+E
				if C.P[J]&hq(N):B+=10
		if A and D in(6,2)or not A and D in(62,58):B+=15
		if C.hw&K==0:B-=10
		if C.hw&L==0:B-=5
		return B
	def ho(B):
		A=0
		for(C,D)in Zb(B.P):
			if D==0:continue
			G=d9[C];E=B.df[G];F=D.bit_count()
			if C<6:A+=E*F
			else:A-=E*F
		return A
	def fq(F):
		C=0
		for B in Ze(12):
			G=B%6;H=dx[G];D=1 if B<6 else-1;A=F.P[B]
			while A:E=(A&-A).bit_length()-1;A&=A-1;I=E if D==1 else E^56;C+=dw[I]*H*D
		return C/2
	def fl(A):B=A.ho();B+=A.p6_safety(1)-A.p6_safety(0);B+=A.fq();return B if A.a1 else-B
	def cn(B,b2):
		A=b2;C=0
		if A[3]:C+=B.df[A[3]]-B.df[A[4]]/10
		if A[2]:C+=B.df[A[2]]*10
		return C
	def fr(B,sq):A=B.fs[sq];return d9[A]if A!=-1 else Za
	def ai(C,mv):
		A=mv;B=da[A[0]%8]+db[A[0]//8]+(da[A[1]%8]+db[A[1]//8])
		if A[2]:return B+A[2]
		return B
def hk(hl):print(hl,flush=1)
def r0():
	A=g4();C=g3(A)
	while 1:
		try:
			B=input()
			if B=='quit':sys.exit()
			elif B=='uci':hk('pygone2.0\nuciok')
			elif B=='ucinewgame':A=g4();C=g3(A)
			elif B=='isready':hk('readyok')
			elif B.startswith('position'):
				A=g4();J=B.split()
				for D in J[3:]:K=A.AB1(D[:2]);L=A.AB1(D[2:4]);M=D[4]if len(D)==5 else Za;A.hn((K,L,M,Za,Za))
				C.G1(A)
			elif B.startswith('go'):
				E=1e8;F=1e8;G=A.a1;H=B.split()
				for(N,I)in Zb(H):
					if I=='wtime'and G or I=='btime'and not G:F=int(H[N+1])/1e3
				E=F/20;C.fg(E);O,Q=C.cl();hk(f"bestmove {str(A.ai(O))}")
		except Exception as P:hk(P);raise
r0()
